---
title: "R Notebook"
output: html_notebook
---

```{r}
library(dplyr)

# прочитати дані
vanguard <- read.csv('VTI.csv', stringsAsFactors = FALSE)
blackrock <- read.csv('BLK.csv')
statestreet <- read.csv('STT.csv')
allianz <- read.csv('ALV.DE.csv')
jpmorgan <- read.csv('JPM.csv')
bankmellon <- read.csv('BK.csv')

allianz <- na.omit(allianz)  # видалити пропущені рядки

# видалити зайві колонки
vanguard <- select(vanguard, -c(Open,High,Low,Adj.Close,Volume))
blackrock <- select(blackrock, -c(Open,High,Low,Adj.Close,Volume))
statestreet <- select(statestreet, -c(Open,High,Low,Adj.Close,Volume))
allianz <- select(allianz, -c(Open,High,Low,Adj.Close,Volume))
jpmorgan <- select(jpmorgan, -c(Open,High,Low,Adj.Close,Volume))
bankmellon <- select(bankmellon, -c(Open,High,Low,Adj.Close,Volume))

# перейменувати колонки
colnames(vanguard)[2] <-"vanguard_price"
colnames(blackrock)[2] <-"blackrock_price"
colnames(statestreet)[2] <-"statestreet_price"
colnames(jpmorgan)[2] <-"jpmorgan_price"
colnames(bankmellon)[2] <-"bankmellon_price"

# змерджити
funds = merge(x=vanguard,y=blackrock,by="Date",all.x=TRUE)
funds = merge(x=funds,y=statestreet,by="Date",all.x=TRUE)
funds = merge(x=funds,y=jpmorgan,by="Date",all.x=TRUE)
funds = merge(x=funds,y=bankmellon,by="Date",all.x=TRUE)

# порахувати ретурни
vanguard_return <- sapply(1:(nrow(funds)-1), function(x, p) { return((p[x+1] - p[x])/p[x]) }, funds$vanguard_price)
blackrock_return <- sapply(1:(nrow(funds)-1), function(x, p) { return((p[x+1] - p[x])/p[x]) }, funds$blackrock)
statestreet_return <- sapply(1:(nrow(funds)-1), function(x, p) { return((p[x+1] - p[x])/p[x]) }, funds$statestreet)
jpmorgan_return <- sapply(1:(nrow(funds)-1), function(x, p) { return((p[x+1] - p[x])/p[x]) }, funds$jpmorgan)
bankmellon_return <- sapply(1:(nrow(funds)-1), function(x, p) { return((p[x+1] - p[x])/p[x]) }, funds$bankmellon)

# зібрати разом ретурни 5 фондів
funds = funds[-1,]
Date = funds$Date
funds_returns = data.frame(Date, vanguard_return, blackrock_return, statestreet_return, jpmorgan_return, bankmellon_return)

# Na    Окремо знайти ретурни для allianz
allianz_return <- sapply(1:(nrow(allianz)-1), function(x, p) { return((p[x+1] - p[x])/p[x]) }, allianz$Close)
allianz_m = allianz[-1,]
Date = allianz_m$Date
allianz_re = data.frame(Date, allianz_return)

# зібрати всі ретурни разом
funds_returns = merge(x=funds_returns,y=allianz_re,by="Date",all.x=TRUE)
View(funds_returns)
```


```{r}
write.csv(funds_returns, file = "Funds.csv")
```

```{r}
library(ggplot2) 
library(scales)

# візуалізація
funds_returns$Date <- as.Date(funds_returns$Date)


ggplot(funds_returns, aes(Date,vanguard_return))  + geom_point(color = "#00AFBB", size = 0.5) + geom_line(color = "#00AFBB", size = 0.5) + labs(x = "date", y = "Return per share", title = "Vanguard") + scale_x_date(labels = date_format("%Y-%m-%d"))

ggplot(funds_returns, aes(Date,blackrock_return))  + geom_point(color = "#00AFBB", size = 0.5) + geom_line(color = "#00AFBB", size = 0.5) + labs(x = "date", y = "Return per share", title = "Blackrock") + scale_x_date(labels = date_format("%Y-%m-%d"))

ggplot(funds_returns, aes(Date,statestreet_return))  + geom_point(color = "#00AFBB", size = 0.5) + geom_line(color = "#00AFBB", size = 0.5) + labs(x = "date", y = "Return per share", title = "Statestreet") + scale_x_date(labels = date_format("%Y-%m-%d"))

ggplot(funds_returns, aes(Date,jpmorgan_return))  + geom_point(color = "#00AFBB", size = 0.5) + geom_line(color = "#00AFBB", size = 0.5) + labs(x = "date", y = "Return per share", title = "Jpmorgan") + scale_x_date(labels = date_format("%Y-%m-%d"))

ggplot(funds_returns, aes(Date,bankmellon_return))  + geom_point(color = "#00AFBB", size = 0.5) + geom_line(color = "#00AFBB", size = 0.5) + labs(x = "date", y = "Return per share", title = "Bankmellon") + scale_x_date(labels = date_format("%Y-%m-%d"))

ggplot(funds_returns, aes(Date,allianz_return))  + geom_point(color = "#00AFBB", size = 0.5) + geom_line(color = "#00AFBB", size = 0.5) + labs(x = "date", y = "Return per share", title = "Allianz") + scale_x_date(labels = date_format("%Y-%m-%d"))
```

